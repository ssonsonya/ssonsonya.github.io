---
layout: post
title: UE4(BP & C++) FootIK ì ìš©
date: 2023-10-12
category: 
- tutorial
- p-UE4
tag:
 - 1|FootIK
 - 1|IKComponent
 - 1|Footstep
 - 1|UStruct
 - 1|Animation

thumbnail: /style/image/challenge_thumbnails/FootIK.png
icon: idea
related: 
 - /2023-11-13-Portfolio-UE4_02
---
IKComponentë¥¼ í†µí•´ Characterì˜ ë°œë°”ë‹¥ê³¼ ì§€í˜•ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë§ë‹¿ì„ ìˆ˜ ìˆë„ë¡ FootIK ì ìš©í•˜ê¸°

![DiffIK](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/417c0b8f-5b6e-4a1f-940a-8a2d2800b860)

* content
{:toc}

## ìš”ì•½ 
- ì£¼ìš” ëª©í‘œ : ì§€í˜•ê³¼ ì–´ìš°ëŸ¬ì§€ëŠ” ì›€ì§ì„ì„ ìœ„í•´ FootIK ì ìš©í•˜ê¸°
- ğŸ’«ë°œìƒ ë¬¸ì œ : Skeletal Meshì˜ `Scale`ì„ ì¡°ìœ¨í•œ ê²½ìš° `Foot Effecter`ê°’ì— ì˜¤ì°¨ ë°œìƒ
- í•´ê²° ë°©ì•ˆ : 
    1. Skeletal Meshì˜ `Foot`ë³¸ì— ì¶”ê°€í•œ Socketì—ì„œë¶€í„° ì§€ë©´ì„ í–¥í•œ ì‹¤ì‹œê°„ ìˆ˜ì§ `Line Trace`ë¡œ ì§€ë©´ê³¼ Footì˜ ìœ„ì¹˜ì™€ ê°ë„ ì°¨ì´ë¥¼ ë°˜í™˜ë°›ì•„ ABPì—ì„œ `Bone Transform`ê³¼ `2 Bone IK`í•¨ìˆ˜ë¡œ í•˜ì²´ ì£¼ìš” Boneì— ì ìš©
    2. `OwnerCharacter`ë¡œë¶€í„° `GetActorScale`ì˜ `Z`ê°’ì„ ë°˜í™˜ë°›ì•„ ê° `Foot Effector`ì— ë‚˜ëˆ„ê¸°
- ì´ë£¨ì–´ë‚¸ ì„±ê³¼ :
    1. ê°ê¸° ë‹¤ë¥¸ Skeletal Meshì™€ Scale êµ¬ì„±ì— ë”°ë¥¸ ì˜¤ì°¨ì—ë„ ì¼ê´„ ì ìš©ê°€ëŠ¥í•œ IKComponent êµ¬í˜„
    2. ê³„ë‹¨ ë˜ëŠ” êµ´ê³¡ìˆëŠ” ì§€í˜•ì— ì˜ ì–´ìš°ëŸ¬ì§€ëŠ” ì›€ì§ì„ êµ¬í˜„
    3. `Bone Transform`ê³¼ `2 Bone IK`ì— ëŒ€í•œ ì´í•´ 

![Abstract](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/d9741d49-7e5a-479e-9662-3f0af94b33ee)

- Line Traceì˜ ì‹œì‘ì ì€ Socketì˜ ìœ„ì¹˜ì§€ë§Œ, ì‹¤ì œ Skeletal Meshì˜ Foot ë³¸ì˜ ìœ„ì¹˜ê°€ ì•„ë‹Œ ë°œë°”ë‹¥ë©´ì˜ ìœ„ì¹˜ì¸ Meshì˜ Locationê³¼ Hitëœ Impact Point ê°„ ê±°ë¦¬ ì¸¡ì •  
    í•˜ì´íì„ ì‹ ì—ˆê±°ë‚˜ ë°œê¿ˆì¹˜ê°€ ë‚©ì‘í•˜ê±°ë‚˜ ë‹¤ì–‘í•œ í˜•íƒœì˜ Meshì—ë„ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤
- ë°”ë‹¥ê³¼ ë†’ì´ì°¨ê°€ ë” í° ê°’ ë§Œí¼ Pelvisë¥¼ ë‚´ë ¤ ìƒëŒ€ì ìœ¼ë¡œ ìœ„ì— ìœ„ì¹˜í•œ ë‹¤ë¦¬ì—ë§Œ ë³€í˜•ì„ ì¤€ë‹¤
    Skeletal Meshì˜ Pelvis ìœ„ì¹˜, í•˜ì²´ ê¸¸ì´ ë¹„ìœ¨ ë“± ë³€ìˆ˜ì— ì˜í–¥ì´ ì—†ë‹¤

![Rotation](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/caf9b044-4fcf-4dfd-b968-bd9ff7ce7ea3)

- LineTrace Hitëœ ì§€ë©´ì˜ Normalë²¡í„°ë¥¼ í†µí•´ ì§€ë©´ì´ ê¸°ìš¸ì–´ì§„ ì •ë„ë¥¼ atan2ë¡œ êµ¬í•  ìˆ˜ ìˆë‹¤
- ì§€ë©´ì˜ ê¸°ìš¸ê¸°ë¡œ ë°œëª©ì˜ Yaw íšŒì „ì´ ì¼ì–´ë‚˜ëŠ” ê²½ìš°ëŠ” ì ì–´ ìƒëµí•˜ê³  Roll, PitchíšŒì „ ê°’ì— ì ìš©

<br>  

---

## Settings

1. Bone Transformì— ì˜í•´ ë³€ë™ë˜ì§€ ì•Šì„ ê³ ì •ê°’ì„ ìœ„í•´ ê° `Foot`ë³¸ì— ì†Œì¼“ ì¶”ê°€
2. IKì •ë³´ë¥¼ ë‹´ì•„ ABPì— ì „ë‹¬í•´ì¤„ êµ¬ì¡°ì²´ `FootIKData` ìƒì„±  

    | êµ¬ë¶„ | ì´ë¦„ | ë‚´ìš© |
    | :---: | :---: | :--- |
    |float|DisplacementZ|Pelvisì— ì ìš©í•  Location.Z|
    |vector|IKEffector_L <br>IKEffector_R|Foot_Lë˜ëŠ” Foot_Rì— Effector Locationìœ¼ë¡œ ì ìš©ë  ë²¡í„°|
    |rotator|Rot_L <br>Rot_R|Foot_L ë˜ëŠ” Foot_Rì— ì ìš©í•  Rotatorê°’|

3. `IKComponent` ì»´í¬ë„ŒíŠ¸ ìƒì„± -> ìºë¦­í„°ì— ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

<br>  

---

## Blueprint IKComponent

FootIKì˜ ê°œë…ê³¼ êµ¬í˜„ë°©ë²•ì€ ê´€ë ¨ [Unreal Engine Documentation](https://docs.unrealengine.com/4.26/en-US/AnimatingObjects/SkeletalMeshAnimation/IKSetups/) [^21] ì™€ [Ryan Laleyì˜ YouTube ì±„ë„ IKì‹œë¦¬ì¦ˆ](https://www.youtube.com/watch?v=dpteQzWMbfQ) [^22] ë¥¼ ì°¸ê³ í–ˆê³ , ì‚¬ìš©í•˜ëŠ” Mannequinì˜ height ë“± Mesh Assetì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¸í•œ ì˜¤ì°¨ë¥¼ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ë³€ìˆ˜ë¥¼ ë‹¤ë¥´ê²Œ ì ìš©í–ˆë‹¤  
![image](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/4b601957-65a6-4f9b-8b58-22e6b0c09832)

ìºë¦­í„°ê°€ ì í”„ë‚˜ ê³µì¤‘ì— ë– ìˆëŠ” ìƒíƒœê°€ ì•„ë‹Œê²½ìš°ì—ë§Œ FootIKê°€ ì ìš©ë˜ë„ë¡ `Branch`ë¥¼ ê±¸ì–´ì¤€ ë’¤ `SetIK`í•¨ìˆ˜ë¥¼ `Tick`ë§ˆë‹¤ í˜¸ì¶œ  

+ Variables

    | êµ¬ë¶„ | ì´ë¦„ | ë‚´ìš© |
    | :---: | :---: | :--- |
    |Character|OwnerCharacter|IKComponentë¥¼ ì†Œìœ í•œ ìºë¦­í„° ì•¡í„°|
    |(struct)FootIKData|FootIKData|IKComponentì—ì„œ ê³„ì‚° ì™„ë£Œë˜ì–´ ABPë¡œ ì „ë‹¬í•´ ì¤„ Transform ë°ì´í„°|
    |float|Displacement|`FootIKData.DisplacementZ`ì— set ë  Pelvisê°€ Zì´ë™í•´ì•¼ í•  ê°’|
    |float|LFootEffector <br>RFootEffector|`FootIKData.IKEffector_L.X` ë˜ëŠ” `FootIKData.IKEffector_R.X`ì— set ë <br> Foot_Lê³¼ ì§€ë©´ì˜ ë†’ì´ ì°¨(ìœ„ì•„ë˜ê°€ ë’¤ì§‘ì–´ì§„ Foot_Rë³¸ìœ¼ë¡œ ì¸í•´ * -1.0f)|
    |rotator|LFootRotator <br>RFootRotator |`FootIKData.Rot_L` ë˜ëŠ” `FootIKData.Rot_R`ì— setë  ì§€ë©´ ë…¸ë§ë²¡í„°ì˜ ì—­ê°|
    |float|CharacterScale|Scaleì ìš©ìœ¼ë¡œ ì¸í•œ ì˜¤ì°¨ê³„ì‚°ìš© `OwnerCharacter`ì˜ `ActorWorldScale3D.Z`|

+ Functions

    | ì´ë¦„ | ë‚´ìš© |
    | :---: | :--- |
    |LineTrace|ì…ë ¥ë°›ëŠ” socketì´ë¦„ì—ì„œë¶€í„° ì§€ë©´ì„ í–¥í•´ ìˆ˜ì§ Line Trace í•œ ë’¤ <br>Hitëœ ì§€ì ì˜ `Impact Point`ì™€ `Normal`ë¡œ ë°œì˜ ìœ„ì¹˜ì™€ ì§€ë©´ì˜ ê±°ë¦¬, ì—­ê°ì„ ë°˜í™˜í•´ì¤„ í•¨ìˆ˜|
    |SetIK|Tickë§ˆë‹¤ ì–‘ ë°œì˜ LineTraceë°˜í™˜ê°’ìœ¼ë¡œ `FootIKData`ë¥¼ Setí•´ì£¼ëŠ” í•¨ìˆ˜|
  
<br>  

### LineTrace

+ Input
    - `InSocketName` : `LineTrace`ë¥¼ ì‹œì‘í•  Socketì˜ ì´ë¦„  
    
+ Return
    - `FootTraceZ` : Socketê³¼ ì§€ë©´ì˜ ê±°ë¦¬(ë†’ì´) ì°¨ì´
    - `FootRot` : ë§ë‹¿ì€ ì§€ë©´ì˜ `Normal Vector`ë¥¼ ì—­ê°ìœ¼ë¡œ ê³„ì‚°í•œ Rotationê°’

<iframe width="100%" height="400" src="https://blueprintue.com/render/cnwk49p0/" scrolling="no" allowfullscreen></iframe>
**Fullscreenë˜ëŠ” Ctrl+ë§ˆìš°ìŠ¤íœ ë¡œ ZoomIn/Out ê°€ëŠ¥*  

1. `Foot_IK`ë³¸ì˜ Locationë¥¼ Line Traceì˜ `Start`ì§€ì ìœ¼ë¡œ, `End`ì§€ì ì€ `Foot_IK`ì˜ X,Y ê°’ê³¼ í•˜ë‹¨ìˆ˜ì§ë°©í–¥ì¸ `OwnerCharacter`ì˜ `Mesh`ì˜ Z + `Max Step Height`ë¡œ Set
    - `Max Step Height`ë¥¼ ì ìš©í•œ ì´ìœ ëŠ” ìºë¦­í„°ê°€ ì í”„ì—†ì´ ì˜¤ë¥´ê±°ë‚˜ ì¶”ë½ì´ ì•„ë‹Œ ê±¸ìŒìœ¼ë¡œ ë‚´ë ¤ê°ˆ ìˆ˜ ìˆëŠ” ë†’ì´ê¹Œì§€ë§Œ ë°œì„ ì˜¬ë¦¬ê±°ë‚˜ ë‚´ë¦¬ëŠ” ê²Œ ìì—°ìŠ¤ëŸ¬ì›Œ ë³´ì´ê¸° ë•Œë¬¸ì´ë‹¤
2. Hitê°€ `false`ì¼ ë• ì´ˆê¸°ê°’(0) ë°˜í™˜
3. Hitëœ `Impact Point`ë²¡í„°ì—ì„œ ìºë¦­í„° `Mesh`ì˜ ìœ„ì¹˜ê¹Œì§€ ê±°ë¦¬ë²¡í„°ë¥¼ êµ¬í•œ ë’¤ `Height`ê°€ ë  `Z`ê°’ì„ `FootTraceZ`ë¡œ ë°˜í™˜
4. Hitëœ `Normal`ë²¡í„°ë¥¼ ì—­ê°ìœ¼ë¡œ ê³„ì‚°í•´ì£¼ê¸°ìœ„í•´ `atan2`ë¡œ `Pitch`ì™€ `Roll`ê°’ ì‚°ì¶œ
  
<br>  

### SetIK
+ Input
    - `InDeltaTime` : Tickí•¨ìˆ˜ì—ì„œ ë°˜í™˜ë°›ëŠ” DeltaSeconds ì „ë‹¬

<iframe width="100%" height="400" src="https://blueprintue.com/render/tz_2_45z/" scrolling="no" allowfullscreen></iframe>
**Fullscreenë˜ëŠ” Ctrl+ë§ˆìš°ìŠ¤íœ ë¡œ ZoomIn/Out ê°€ëŠ¥*  

1. ê° ë°œì˜ IKê³„ì‚°ì„ ìœ„í•´ ì¶”ê°€í•œ `Socket`ì„ ì¸ìë¡œ `LineTrace` ë°œë§ˆë‹¤ í˜¸ì¶œ
2. `LineTrace`ë¡œ ë°˜í™˜ ë°›ì€ `FootTraceZ`ê°’ì„ í•´ë‹¹ ë°œì˜ `FootEffector`ì— Set
3. ê°‘ì‘ìŠ¤ëŸ° ìœ„ì¹˜ì ìš©ì´ ì–´ìƒ‰í•  ìˆ˜ ìˆì–´('ëœ¬!'í•˜ê³  ëˆˆê¹œì§ í•  ì‚¬ì´ì— ë°”ë€Œì–´ ìˆëŠ” ìœ„ì¹˜) `FInterp`ìœ¼ë¡œ ë³´ê°„ ì ìš©
4. `LineTrace`ë¡œ ë°˜í™˜ ë°›ì€ `FootRot`ê°’ì„ í•´ë‹¹ ë°œì˜ `FootRotation`ì— `RInterp`ìœ¼ë¡œ Set
5. ê° Interp speedëŠ” ëŸ°íƒ€ì„ í™•ì¸ í›„ `10.0f`ê°€ ê°€ì¥ ì ì ˆí•˜ì—¬ ìƒìˆ˜ Set
6. `LFootEffector`ì™€ `RFootEffector`ì˜ ì ˆëŒ€ê°’ ì¤‘ ë” í° ê°’ ë§Œí¼ Pelvisë¥¼ ì´ë™í•  ìˆ˜ ìˆê²Œ `Displacement`ì— `FInterp` Set
7. `FootIKData.DisplacementZ`ì— `Displacement`ë¥¼ * -1.0f í•´ì„œ Set : Pelvisë¥¼ ë‚´ë ¤ì¤€ë‹¤
8. `FootIKData.IKEffector_L.X`ì— ë‚´ë ¤ì¤€ Pelvisë§Œí¼ ë” ë‚´ë¦¬ê¸° ìœ„í•´ `LFootEffector`ì— `Displacement`ë¥¼ ëºŒ
9. `FootIKData.IKEffector_R.X`ì—ë„ `RFootEffector`ì—ì„œ `Displacement`ë¥¼ ë¹¼ì¤€ ë’¤ ë’¤ì§‘ì–´ì§„ `Foot_R`ì˜ Xì¶•ì— ë§ê²Œ * -1.0f
10. `Scale`ì´ í¬ê±°ë‚˜ ì‘ì€ Skeletal Meshì˜ ê²½ìš°ë¥¼ ìœ„í•´ `CharacterScale`ê°’ì„ ê° ë°œì— ë‚˜ëˆ ì¤Œ
    - Scaleì´ ì»¤ì§„ ê²½ìš° í•´ë‹¹ Scaleë§Œí¼ ë°œê³¼ ì§€ë©´ì˜ WorldSpaceìƒì—ì„œì˜ ê±°ë¦¬ì°¨ê°€ ì»¤ì§€ì§€ë§Œ BoneSpaceëŠ” Scaleì— ì˜í–¥ì„ ë°›ì§€ ì•Šìœ¼ë¯€ë¡œì„ ì—­ì‚°í•´ì¤€ë‹¤  

![Scale applied](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/6018f1dd-0e26-410b-b54b-7db7b39938b4)

---

## C++ IKComponent

```c++
// CFootIKComponent.h
#pragma once
#include "CoreMinimal.h"
#include "Components/ActorComponent.h"
#include "Kismet/KismetSystemLibrary.h"
#include "CIKComponent.generated.h"

USTRUCT(BlueprintType)
struct FFootIKData
{
    GENERATED_BODY()
public:
    UPROPERTY(BlueprintReadOnly, Category = "FootIK")
        FVector IKEffector_L;
    UPROPERTY(BlueprintReadOnly, Category = "FootIK")
        FVector IKEffector_R;
    UPROPERTY(BlueprintReadOnly, Category = "FootIK")
        FVector DisplacementZ;
        
    UPROPERTY(BlueprintReadOnly, Category = "FootIK")
        FRotator Rot_L;
    UPROPERTY(BlueprintReadOnly, Category = "FootIK")
        FRotator Rot_R;
};

UCLASS( ClassGroup=(Custom), meta=(BlueprintSpawnableComponent) )
class UE4_TPSProject UCIKComponent : public UActorComponent
{
    GENERATED_BODY()
public:
    UCIKComponent();
protected:
    virtual void BeginPlay() override;
public:	
    virtual void TickComponent(float DeltaTime, ELevelTick TickType, FActorComponentTickFunction* ThisTickFunction) override;

private:    // Functions
    void LineTrace(FName InSocketName, float& OutFootTraceZ, FRotator& OutFootRot);

public:     // Inline
    FORCEINLINE FFootIKData GetData() { return FootIKData; }

private:    // UProperty Members
    UPROPERTY(EditAnywhere, Category = "LineTrace")
        TEnumAsByte<EDrawDebugTrace::Type> DrawDebug;
    UPROPERTY(EditAnywhere, Category = "LineTrace")
        float Displacement = 0.0f;
    UPROPERTY(EditAnywhere, Category = "LineTrace")
        float LFootEffector = 50.0f;
    UPROPERTY(EditAnywhere, Category = "TraLineTracece")
        float RFootEffector = 5.0f;
    UPROPERTY(EditAnywhere, Category = "LineTrace")
        FName LeftSocketName = "Foot_L_IK";
    UPROPERTY(EditAnywhere, Category = "LineTrace")
        FName RightSocketName = "Foot_R_IK";

private:    // Private Members
    class ACharacter* OwnerCharacter;
    FFootIKData FootIKData;
    float InterpSpeed = 10.0f;
    float CharacterScale = 1.0f;
};
```

```c++
// CFootIKComponent.cpp
#include "02_Components/CFootIKComponent.h"
#include "Global.h" // Utilities
#include "GameFramework/Character.h"
#include "Components/SkeletalMeshComponent.h"
#include "Components/CapsuleComponent.h"

#define LOG_UCFootIKComponent   // Debug Log

UCFootIKComponent::UCFootIKComponent()
{
    PrimaryComponentTick.bCanEverTick = true;
}

void UCFootIKComponent::BeginPlay()
{
    Super::BeginPlay();
    OwnerCharacter = Cast<ACharacter>(GetOwner());
}
```

<br>  

### LineTrace

```c++
// CFootIKComponent.cpp
void UCFootIKComponent::LineTrace(FName InSocketName, float& OutFootTraceZ, FRotator& OutFootRot)
{
    // Trace Start
    FVector start = OwnerCharacter->GetMesh()->GetSocketLocation(InSocketName);

    // Trace End
    FVector meshLocation = OwnerCharacter->GetMesh()->GetWorldLocation();
    float z = meshLocation.Z - OwnerCharacter->GetCharacterMovementComponent().MaxStepHeight;
    FVector end = FVector(socketLocation.X, socketLocation.Y, z);

    // LineTrace
    TArray<AActor*> ignores;
    ignores.Add(OwnerCharacter);
    FHitResult hitResult;
    
    UKismetSystemLibrary::LineTraceSingle(GetWorld(), start, end, ETraceTypeQuery::TraceTypeQuery1, true, ignores, DrawDebug, hitResult, true,FLinearColor::Green, FLinearColor::Red);
    
    // Init Outputs
    OutFootTraceZ = 0.0f;
    OutFootRot = FRotator::ZeroRotator;
    
    // Check Validity
    CheckFalse(hitResult.bBlockingHit);
    
    // OutFootTraceZ
    FVector distance = (hitResult.ImpactPoint - OwnerCharacter->GetMesh()->GetWorldLocation());
    OutFootTraceZ = distance.Z;

    // OutFootRot
    float roll = UKismetMathLibrary::DegAtan2(hitResult.Normal.Y, hitResult.Normal.Z);
    float pitch = UKismetMathLibrary::DegAtan2(hitResult.Normal.X, hitResult.Normal.Z) * -1.0f;	// -1 to Rotate in opposite direction
    OutRotation = FRotator(pitch, 0, roll);
}
```

<br>  

### Tick(SetIK)

```c++
// CFootIKComponent.cpp
void UCFootIKComponent::TickComponent(float DeltaTime, ELevelTick TickType, FActorComponentTickFunction* ThisTickFunction)
{
    Super::TickComponent(DeltaTime, TickType, ThisTickFunction);
    
    // Check isFalling
    CheckFalse(OwnerCharacter->GetCharacterMovementComponent()->IsFalling());

    // Temp Variables
    float leftTrace = 0.0f;
    float rightTrace = 0.0f;
    float displacement = 0.0f;
    FRotator leftRot;
    FRotator rightRot;

    // Character Scale Check
    CharacterScale = OwnerCharacter->GetActorWorldScale3D().Z;
    
    // LineTrace from both Sockets
    LineTrace(LeftSocketName, leftTrace, leftRot);
    LineTrace(RightSocketName, rightTrace, rightRot);

    // Pelvis
    displacement = FMath::Max(Abs(leftTrace), Abs(rightTrace));
    
    FootIKData.DisplacementZ.Z = UKismetMathLibrary::FInterpTo(FootIKData.DisplacementZ.Z, displacement, DeltaTime, InterpSpeed);
    
    // Left Foot
    FootIKData.IKEffector_L.X = UKismetMathLibrary::FInterpTo(FootIKData.IKEffector_L.X, (leftTrace-displacement) / CharacterScale, DeltaTime, InterpSpeed);
    FootIKData.Rot_L = UKismetMathLibrary::RInterpTo(FootIKData.Rot_L, leftRot, DeltaTime, InterpSpeed);
    
    // Right Foot
    FootIKData.IKEffector_R.X = UKismetMathLibrary::FInterpTo(FootIKData.IKEffector_R.X, -(rightTrace-displacement) / CharacterScale, DeltaTime, InterpSpeed); // -rightTrace due to opposite bone direction
    FootIKData.Rot_R = UKismetMathLibrary::RInterpTo(FootIKData.Rot_R, rightRot, DeltaTime, InterpSpeed);
    

#ifdef  LOG_UCFootIKComponent
	CLog::Print(FootIKData.DisplacementZ, 11);
	CLog::Print(FootIKData.IKEffector_L, 12);
	CLog::Print(FootIKData.Rot_L, 13);
	CLog::Print(FootIKData.IKEffector_R, 14);
	CLog::Print(FootIKData.Rot_R, 15);
#endif // LOG_UCFootIKComponent
}
```
---

## Animation Blueprint 

+ Variables
    - `component IKComp` : `OwnerCharacter`ë¥¼ í†µí•´ ê°€ì ¸ì˜¨ IKComponent ë³€ìˆ˜ë¡œ Set
    - `(struct)FootIKData FootIKData` : `IKComp`ê°€ ìœ íš¨í•  ê²½ìš° Getterë¡œ ê°€ì ¸ì™€ ë³€ìˆ˜ë¡œ Set
    - `bool IKSpace` : IK ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ìƒí™© ì²´í¬ë¥¼ ìœ„í•œ bool  
        ex) Playerì˜ ê²½ìš° Parkour ì§„í–‰ ì‹œ IK ì ìš©í•´ì œ

+ Animation Layer
    1. ìµœì¢… ì• ë‹ˆë©”ì´ì…˜ í¬ì¦ˆ ë°˜í™˜ ì§ì „ `IKLayer` ë§í¬
    2. `IKSpace`ì˜ ê°’ì— ë”°ë¼ boolë¡œ í¬ì¦ˆë¸”ëœë”©

### SetUpBasicData

![image](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/e0e20b25-d56b-4892-acec-8b33ff02ef28)

`BlueprintUpdateAnimationEvent`ë¥¼ í†µí•´ Updateë§ˆë‹¤ `OwnerCharacter`ì˜ `IKComponent`ë¥¼ í†µí•´ `FootIKData`ë¥¼ Setí•´ì£¼ê³  ìºë¦­í„°ì˜ ìƒíƒœì— ë”°ë¼ ìœ íš¨ì„± í™•ì¸ì„ ìœ„í•´ `bool IKSpace` ì²´í¬

<br>  

### IKLayer
![image](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/61b9f935-3f08-42a1-b00b-b5a2238f21bf)
![image](https://github.com/ssonsonya/ssonsonya.github.io/assets/116151781/82c90921-8ae9-4abc-b86e-9c759a5e1e5d)

ì…ë ¥ë°›ì€ í¬ì¦ˆì˜ ë³¸ì— ë³€í˜•ì„ ì¤„ ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸ Spaceë¡œ ì „í™˜í•´ `Bone Transform`ê³¼ `2 Bone IK`í•¨ìˆ˜ë¡œ IK ì ìš©ëœ í¬ì¦ˆ êµ¬í˜„

+ Pelvis
    `Bone Transform` :  
    Translation ê¸°ì¡´ ìœ„ì¹˜ì—ì„œ WorldSpaceê¸°ì¤€ `FootIKData.DisplacementZ` Add to Existing
+ Foot_L
    1. `2 Bone IK` :  
    Effector Location - Foot_L ë³¸ì˜ ê¸°ì¡´ ìœ„ì¹˜ì—ì„œ BoneSpaceê¸°ì¤€ `FootIKData.IKEffector_L` ì…ë ¥  
    Joit Target Location - Calf_L ë³¸ì˜ ê¸°ì¡´ ìœ„ì¹˜ì—ì„œ ì‚´ì§ ì•ìœ¼ë¡œ í–¥í•  ìˆ˜ ìˆê²Œ BoneSpaceê¸°ì¤€ìœ¼ë¡œ ì ìš©  
    ëŸ°íƒ€ì„ìœ¼ë¡œ í™•ì¸ í›„ X=0.0, Y=30.0, Z=-5.0 ì •ë„ê°€ ì ì ˆí•˜ì—¬ ì ìš©  
    2. `Bone Transform` :  
    Rotation ê¸°ì¡´ íšŒì „ê°’ì—ì„œ WorldSpaceê¸°ì¤€ `FootIKData.Rot_L` Add to Existing
+ Foot_R  
    Foot_Lê³¼ ë™ì¼í•˜ê²Œ í•´ë‹¹í•˜ëŠ” ë³¸ì— `FootIKData`ì˜ ì •ë³´ ì ìš©  
    `2 Bone IK`í•¨ìˆ˜ Joint Target Locationì˜ Calf_RëŠ” ë°˜ëŒ€ìª½ ë‹¤ë¦¬ì™€ ìƒë°˜ëœ ì¶•ì„ ê°€ì§€ê³  ìˆì–´ X=0.0, Y=-30.0, Z=5.0 ì •ë„ê°€ ì ì ˆ  

---

## ìƒê°ì •ë¦¬

> ê¸°ë³¸ì— ì¶©ì‹¤í•˜ê¸°  

ê¸°ë³¸ì ìœ¼ë¡œ ë¬´ë£Œë¡œ ì œê³µë˜ëŠ” í›Œë¥­í•œ IK Pluginë“¤ì´ ìˆìœ¼ë‚˜ ì—­ì‹œë‚˜ ë°œë™í•œ ê°œë°œìš•ì‹¬ì— í•˜ë‚˜í•˜ë‚˜ ë§Œì ¸ë³´ê³  ê²°êµ­ ì›í•˜ëŠ” ëª¨ìŠµì„ êµ¬í˜„í•´ ë¿Œë“¯í•˜ë‹¤  
FootIKë¥¼ ì ìš©í•´ì£¼ê¸° ìœ„í•´ ì—¬ëŸ¬ Tutorialë“¤ì„ ë³´ì•˜ìœ¼ë‚˜,  
ì–¸ë¦¬ì–¼ì—”ì§„ì˜ ë””í´íŠ¸ 3rd Person Character ë˜ëŠ” ê°œì¸ì ìœ¼ë¡œ ì ìš©í•œ íŠ¹ì • Skeletal Mesh ê²½ìš°ì— ì ìš©ëœ Foot IKë¡œ í‚¤ ì°¨ì´ ë“±ì˜ offsetì„ ìƒìˆ˜ë¡œ ì ìš©í•˜ëŠ” ì¼€ì´ìŠ¤ë“¤ ë¿ì´ì—ˆë‹¤  
ìºë¦­í„°ë“¤ì´ ë³€ì‹ í•˜ê³  Scaleë„ ë³€í˜•ë˜ë„ë¡ ì„¤ì •í•œ ë‚´ í”„ë¡œì íŠ¸ì—ì„  ì´ëŸ¬í•œ ìƒìˆ˜ê°’ì„ ìµœëŒ€í•œ ì¤„ì´ê³ ì ê³ ë¯¼ì„ ë§ì´í–ˆë‹¤  
ê²°êµ­ ê¸°ë³¸ ê°œë…ì„ ë‹¤ì‹œ ì •ë¦¬í•´ ìµœëŒ€í•œ ê°„ë‹¨íˆ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ ì„±ê³µí•˜ê²Œ ë˜ì—ˆê³  ì—­ì‹œ ê¸°ë³¸ê¸°ê°€ íƒ„íƒ„í•´ì•¼ í™œìš©ì— ê°•í•´ì§ˆ ìˆ˜ ìˆìŒì„ ë‹¤ì‹œê¸ˆ ê¹¨ë‹«ëŠ” ì‹œê°„ì´ì—ˆë‹¤  

---

## Reference

[^21]: [Unreal Engine. Unreal Engine Documentation. IK Setups](https://docs.unrealengine.com/4.26/en-US/AnimatingObjects/SkeletalMeshAnimation/IKSetups/)
[^22]: [Ryan Laley(2020.09.09).YouTube. Unreal Engine 4 Tutorial - IK Part 1 - Understanding IK](https://www.youtube.com/watch?v=dpteQzWMbfQ)