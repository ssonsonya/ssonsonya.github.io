---
layout: post
title: 사무용 노트북으로도 작업가능한 최적화기법
date: 2023-12-1
category: 
 - portfolio
 - p-UE4
tag:
 - 1|최적화
 - 1|Merge-Mesh
 - 1|HLOD
 - 1|CullDistanceVolume
thumbnail: /style/image/portfolio_thumbnails/UE4/RenderOpt.png
icon: game
---

고사양 레벨 애셋 사용을 위한 언리얼의 다양한 랜더링 프로파일링 기능 정리 및 최적화 적용사례 기록  

* content
{:toc}

## 요약

- 주요 문제 : 고사양을 요구하는 백그라운드 애셋 적용 시 심각한 프레임드랍으로 작업진행 어려움
- 해결 방안 : `Mesh Merge`로 드로우콜 최소화, `LOD`와 `HLOD`를 활용해 비용절감  
- 그 외 시도한 방법들 :  
    1. 에디터 그래픽 설정 변경  
    2. Mesh LOD 설정 조율 : Triangle 수 최소화  
    3. `Cull Distance Volume` 활용 카메라 거리에 따른 소형애셋 드로우 조정  
    4. `Mesh Collision` 설정  
- 이루어낸 성과 :  
    1. 작업환경에 제한받지 않는 최적화 기법으로 작업 완료  

---
- 작업환경 주요 SPEC  

    | CPU | GPU |
    | :---: | :---: |
    | intel i7 4코어 6스레드 | 내장 |

- 사용한 애셋 정보  
    ![image](https://github.com/user-attachments/assets/7b171374-dee5-418e-b897-6d9bbd9c428b)  

    기술 세부사항  
    - 500 ~ 5000 tri수를 가진 매쉬가 대부분이며 최대 350,000까지 있음  
    - 텍스처 해상도 4096 x 4096  

    고사양 컴퓨터에서 사용을 권장한다는 문구가 이제서야 눈에 들어온다..  
    > *This pack is almost 10GB in size  
    and with all features enabled is recommended for higher-end PC's.  
    All features are recommended for highest quality results*  

- 레벨 애셋 적용 후 랜더링 상태   

    |프로젝트 크기| DrawCallMesh | TrianglesDrawn | FPS |
    | :---: | :---: | :---: | :---: |
    | 12.5GB (+8GB) | 2556.30 | 90,854,592 | 50ms (약 20 fps) |

    프로젝트 자체 볼륨도 매우커져 파일 실행에도 10분 이상이 걸리는 상황이라 진행에 어려움을 겪음.

---

## 랜더링 비용 확인방법

[문브러쉬 님의 유튜브](https://youtu.be/maHHsDd3j5A?feature=shared) [^11] 영상을 통해 적용사례를 확인하고, [언리얼엔진 문서](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/optimizing-and-debugging-projects-for-real-time-rendering-in-unreal-engine) [^12] 를 통해 개념을 이해했습니다.  

| 구분 | 내용 | 상세정보 |
| :---: | :---: | :---: |
| (cmd) stat scenerendering | 뷰포트의 랜더링정보 통계자료 조회 | Mesh draw calls : 드로우콜 수 |
| (cmd) stat RHI | RHI 메모리 및 퍼포먼스 통계 | Triangles drawn : 랜더된 트라이앵글(폴리곤) 수 |
| (cmd) stat unit & unitgraph | 밀리초단위의 프레임 수와 영향을 주는 주 요소 | CPU 게임 스레드, CPU 렌더 스레드, GPU |
| 창 > 통계 | 라이팅, 텍스쳐, 프리미티브 관련 데이터 통계 확인 |  상위 Tri오브젝트 조회 |


+ 뷰포트에서의 DrawCall / Triangles Drawn 확인  
    런타임, 에디터에서 확인 가능하며 에디터에선 STAT표시 토글 : Shift+L 가능  
    \`cmd 호출 > `stat scenerendering`
    ![스크린샷 2024-11-16 035630](https://github.com/user-attachments/assets/88a9b40f-da3f-4d16-ba06-bfa9645e5d90)   
    \`cmd 호출 > `stat RHI`  
    ![스크린샷 2024-11-16 035544](https://github.com/user-attachments/assets/1b01076e-2a28-4110-90bf-dada2bf7984e)  

+ CPU와 GPU사용량 확인
    \`cmd 호출 > `stat unit` `stat unitgraph`
    <img align="center" width="500" src="https://github.com/user-attachments/assets/be027a3c-d67f-4e46-b4e5-0c9c495b710d">


+ 프리미티브 통계정보 확인  
    창 > 통계
    ![image](https://github.com/user-attachments/assets/e5cbee11-a5b0-42b1-80b0-1dcb00f9cd51)  


## Mesh Merge

## HLOD

### Nanite

## 그 외 시도한 방법들

### 에디터 그래픽설정
### Mesh LOD설정
### Cull Distance Volume

## 생각정리

## Reference

[^11]:[문브러쉬(2023.1.12). YouTube. 언리얼엔진 드로우콜 확인하기](https://youtu.be/maHHsDd3j5A?feature=shared)  
[^12]: [Unreal Engine. Unreal Engine Documentation. 실시간 렌더링을 위한 프로젝트 최적화 및 디버깅](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/optimizing-and-debugging-projects-for-real-time-rendering-in-unreal-engine)  


[Unreal Engine Documentation. Cull Distance Volume](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/cull-distance-volume?application_version=4.27)